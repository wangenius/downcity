层级 作用 生命周期 示例
Shot 当前会话/任务状态，所有轮次上下文 会话结束即销毁 当前任务参数、最近对话、临时变量
Memory 跨 Shot 的短期/中期记忆 多个会话，保留近期信息 用户偏好、任务进度摘要、最近几个任务的核心信息
Room 长期记忆 + 知识库 永久保存 用户画像、历史事件、知识文档

好的，我帮你设计一张 **Memory + Shot + Room 模块关系图**，用来直观展示它们的职责、数据流和调用关系。这里先用文字版示意图，方便你理解：

```
               +---------------------+
               |      User Input     |
               +---------------------+
                        |
                        v
                +-----------------+
                |     Shot      |  <-- 每个 Shot 独立管理
                |-----------------|
                | 当前轮次对话上下文 |
                | 临时任务状态      |
                | 临时变量          |
                +-----------------+
                        |
                        v
               +-------------------+
               |       Room      |  <-- 跨 Shot 短期/中期记忆
               |-------------------|
               | 最近会话摘要       |
               | 用户偏好          |
               | 最近任务概要       |
               +-------------------+
                        |
                        v
               +-------------------+
               |       Codex       |  <-- 长期记忆 + 知识库
               |-------------------|
               | 用户画像           |
               | 历史事件           |
               | 知识文档           |
               +-------------------+
                        |
                        v
                +-----------------+
                |       LLM       |  <-- Agent 调用生成回答
                +-----------------+
                        |
                        v
               +---------------------+
               |    Response Output  |
               +---------------------+
```

### 数据流说明

1. **Shot**

   - 保存当前会话所有上下文和任务状态
   - 每轮对话更新
   - 生命周期短，任务结束或会话结束即销毁

2. **Room**

   - 管理多个 Shot 的核心摘要信息
   - 提供跨会话连续性
   - 可检索最近几个会话的摘要或用户偏好

3. **Codex**

   - 管理长期记忆和知识库
   - 更新低频，存储重要用户信息、历史事件和文档
   - 可以被 LLM 调用进行 RAG 或个性化回答
